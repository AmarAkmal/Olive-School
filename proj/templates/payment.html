<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Payment Made Olive School</title>

    <link rel="icon" type="image/png" sizes="16x16" href="../static/assets/img/olive.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../static/assets/img/olive.png">
    <link rel="icon" type="image/png" sizes="96x96" href="../static/assets/img/olive.png">

    <link rel="stylesheet" href="../static/lib/bootstrap.min.css">
    <style>
        body, html, #wrapper { width: 100%; height: 100% }
    #wrapper { display: table;
    padding: 40px;}
    #main {
        display: table-cell;
        {#vertical-align: middle;#}
        text-align:center }
    </style>
</head>
<body>
<div id="wrapper">

    <div class="card border-dark mb-3" style="max-width: 20rem;" id="main">
      <div class="card-body">
          <img src="../static/assets/img/olive.png"><br><br><br>
            <h5 class="card-title">Payment status :
                <span id="status"><strong>Success</strong></span>
            </h5>
            <h5 class="card-title">BillCode : <span id="billCode"></span></h5>
            <h5 class="card-title">Order Id :  <span id="orderId"></span></h5>
            <h5 class="card-title">Transaction Id :  <span id="transactionId"></span></h5>
            <p>*** Wait until this window close.</p>
      </div>
    </div>
</div>
</body>
    <script src="../static/bower_components/jquery/dist/jquery.js"></script>
    <script>
        console.log(getUrlVars());
        var data = getUrlVars();
        if(data.hasOwnProperty("status_id")) {
            if(data['status_id'] === '1'){
                $('#status').html('Success');
                $('#status').addClass('text-success');
            }else if(data['status_id'] === '2'){
                $('#status').html('Pending');
                $('#status').addClass('text-warning');
            }else{
                $('#status').html('Fail');
                $('#status').addClass('text-danger');
            }
            $('#billCode').html(data['billcode']);
            $('#orderId').html(data['order_id']);
            $('#transactionId').html(data['transaction_id']);
            updatePayment(data['status_id'],data['billcode'],data['order_id']);
        }

        function getUrlVars()
        {
            var vars = [], hash;
            var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
            for(var i = 0; i < hashes.length; i++)
            {
                hash = hashes[i].split('=');
                vars.push(hash[0]);
                vars[hash[0]] = hash[1];
            }
            return vars;
        }
        
        function updatePayment(statusId,billCode,orderId){
            {#$.get('http://localhost:5000/account/update_payment?statusId='+statusId +'&billCode=' + billCode + "&orderId=" + orderId, function (data, textStatus, jqXHR) {#}
            $.get('https://theolivetrees.edu.my/management/account/update_payment?statusId='+statusId +'&billCode=' + billCode + "&orderId=" + orderId, function (data, textStatus, jqXHR) {
                    console.log(data);
            });
        }
    </script>
</html>